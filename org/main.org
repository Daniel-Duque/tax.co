* TODO next
** TODO These error codes apply to all income and expense variables
98 means people know they moved some money but do not know the amount; 
00 means no
99 means people do not know if it happened

** discard non-household household members
P6050 = "unidad de gasto", if equal to 6,7, or 8
** ? when unsure of VAT, provide a min and max, make two estimates
** TODO some cap c observations should be discarded
For both urban and rural, if NC2_CC_P3_S2 is yes, discard.
  That's because they'll show up in another file, disaggregated to COICOP level.
** update the backup on sharepoint of the coicop-vat bridge
** region : no VAT in San Andres
** TODO frequency
*** use the rural cap c legend for everything
**** it's consistent with everything but the urban cap c legend, which appears to be wrong; the Stata legends are consistent
*** if "nunca", discard
** TODO value : if 99 in capitulo C, discard
** where-got
*** use the rural_semanal_fuera key; it's a superset of the others
*** TODO david : we believe there is no interaction between where-got and coicop
** TODO with David : coicop: lots of special cases
*** 5310101
DS guesses 19% more often
5% if: 
  price < (30 uvt (unidad de valor tributario), aprox. $955800 COP)
  AND estrato <= 3
  AND gave back old fridge when made this purchase (not knowable in our data)
19% otherwise
c.f article 468.1 of tax code
*** 7110101 : bears on INC
In addition to VAT, these are taxed with the impuesto nacional al consumo, INC: for vehicles with value below USD$30000 the rate for the INC is 8%; if the value is above USD$30000, the rate is 16%. (INC is charged at the end of the supply chain only.)
*** 7110102
**** our heuristic: assume they sell for less than they bought, therefore 0 VAT
**** what I wrote after talking to David
= second hand purchases of vehicles
Suppose Manufacturer sells to Alice (an ordinary person), and Alice sells to Bob. Alice paid PA, which is equal to PM (what the manufacturer collects) + TA (VAT charged to Alice). Then Bob pays PB, which equals ...

okay something like that. Alice paid X. Now Alice sells to Bob. Alice collects Y from Bob. If Y > X, then Bob pays VAT equal to 0.19*(Y-X).
**** what David emailed that I didn't understand so I talked to him (above)
special tax base for VAT purposes: If a retailer buys a used car priced initially at $20 and resells it at $22, the vat rate is applied to the difference. In addition, these transactions are also taxed with the impuesto nacional al consumo, INC: for vehicles with value below USD$30000 the rate for the INC is 8%; if the value is above USD$30000, the rate is 16%
*** 7120101
**** upshot : call it 0.12, the average of electric bike rate (5) and motorbike (19)
**** details from David's email
goods with different tax rates. Minor details regarding VAT exclusions for Amazonas, Vaup�s, Guain�a. In addition, only motorbikes are taxed with the impuesto nacional al consumo, INC: an extra 8% is charged if engine is above 200 c.c.
*** TODO 7130101 : VAT rate depends on price
Depending on value an nature. If value is below 50 UVT (aprox $1593000 COP) the VAT rate is 5%, otherwise 19%
*** 7219901, Motores para veh�culo
VAT could be 0, 5 or 19
We're guessing 15
*** 7219902, misc car goods
Mostly 19, we're saying 19.
*** 7350101, mixed transport
19 for air travel, otherwise 0; we're saying 0.
*** 8200203, smart phones
0 VAT if cheap, 19 if expensive
threshold at 22UVT, aprox. $700800 COP
** interpret region
centro poblado = smallest unit
otras cabeceras = bigger, aggregate of municipalities
bigger yet are cities, which are identified by name
rural disperso = by area biggest, but low population (and low density)

Luis wanted at least for ...
  - Bogota
  - Medellín
  - Cali
  - Barranquilla+Soledad (one metro area)
  - Bucaramanga
  - Cartagena
  - Cúcuta
  - Ibagué
  - Pasto
  - Popayán
** TODO start saving build stages
*** but don't overwrite pre-release data!
** maybe separate pensions from other benefits?
** some questions that seem to overlap
*** sale of title
 P7510S9 = "rendimientos por venta de titulos"
 P7513S4 = "Ventas de acciones y de títulos valores"
*** loans
 P7513S5 = "Reembolsoso de dinero prestado por usted o a otra persona"
 P7513S7A1 = " Préstamos particulares"
** unsorted
*** "P6500 (asalariado income) > 0" should be perfecty corr'd with pension contrib's
*** ??? pension contribs = formality.
** value = expense; price = value / quantity
*** David used real data, e.g. rice price, to figure this out. Genius.
* to explain in paper : institution details | judgment calls
** benefits/expenses that we ignored
*** P1651S1 : fulfillment insurance : ignonred
ambiguous whether it's an expense or part of salary, and the frequency is roughly unavailable -- we know the freq only for the most recent contract.

"¿Por este trabajo, le descontarono pagó póliza de cumplimiento? ¿cuánto?"
*** more
ambiguous definition, missing values, impossible values

P6920* : pension fund contributions
P6990* : work injury insurance
P9450* : caja de compensacion
** no vat 6 » 6.Supermercado y tiendas de barrio
Supermarkets charge VAT, but there are more tiendas de barrio, so we're saying none.

Could go into more detail, about each category.
** we include infrequent income in monthly income
sales, loan repayment, jury awards, gambling winnings, inheritance ...
** We don't count borrowing as income, because you don't pay for your income with later income.
** P7500S3A1 : alimony. ignoring, to avoid double-counting.
** terms in the ENPH
*** Unemployed
During the past four weeks, actively searching for a job and available last week to start in case of success; or employed at least 2 weeks over the last 12 months, has actively searched after last job and was available last week to start in case of success; or not employed at least 2 weeks over the last 12 months, has actively searched after last job and was available last week to start in case of success.
*** Inactive 
Permanent disability; or During the past four weeks, actively searching for a job and not available last week to start in case of success; or not willing to work; or full-time students; or employed at least 2 weeks over the last 12 months but has not actively searched after last job; or full time domestic work; or has not searched for a job during the past 12 months; or has searched a job over the last 12 months but was not available to start last week in case of success.
** they are asked on the 15th about consumption on days 1-14
** where-got: if missing, assume taxed
# Even when purhcase=1, in some files there are a substantial number
# of observations where where-got is missing. A way to see that:
util.dwmByGroup( "file-origin",
                 data.purchases[ data.purchases["is-purchase"]==1 ]
                 [["file-origin","where-got"]] )
** freq: if missing, discarded
*** when is-purchase=1, freq is undefined only .015 % of the time
*** so omitting purchase!=1 observations won't bias our estimate of VAT
*** it will, however, bias (downward) our estimate of consumption
** we don't include property purchases
*** there is no VAT on land purchases
*** there is 5% VAT for purchases of *new* homes in excess of 880 M pesos
**** but the data only reports newness in the case of second homes
**** that's a very small fraction of the economy
** more than 2/3 of the "capitulo c" observations have no associated value
*** and they are only divided into 25 broad categories, with no associated quantity variable, so imputation is infeasible
*** Those value-missing observations are 19.2% of our data.
Hopefully that will be close to 0 after discarding:
  frequency = nunca
  ~ bought it in the last week
  value = 99
* would be nice
** to have a default value for freq
*** when is-purchase=1, freq is undefined only .015 % of the time
*** so omitting purchase!=1 observations won't bias our estimate of VAT
*** it will, however, bias (downward) our estimate of consumption
* about the data|results
** The ENPH : http://microdatos.dane.gov.co/index.php/catalog/566/get_microdata
** the 200 / 1400 missing COICOP codes appear not to matter much
*** the 80% of purchases that carry 0 VAT are due to a literally 0 VAT, not a NaN VAT
*** in the 10% sample less than 0.3% of the purchases have a NaN vat rate
x = purchases["vat-rate"]
>>> len(x)
7458243
>>> len( x[ x.isnull() ] )
28986
>>> 28986 / 7458243
0.0038864381329490067
* restaurant|cafeteria tax / todo
** if bought in cafeteria or restaurant, gets the 8% tax and no VAT, but otherwise they would pay VAT
* income tax / todo
** ENPH asks about income tax
** if no SS payments and (or?) making less than min wage, informal
** primary inputs: income, kids, voluntary pension fund contributions.
** at most 40% of a person's inncome can be exempt.
* VAT / todo
** code-internal
*** pdflatex: send reports to a file, not stdout
**** this way it doesn't drown the python error reports
** check data
*** are these two variables ever both > 0 ?
**** P5180S1, P5180S2 : daily payment for, value of food at school
**** P6180S1, P6180S2 : daily payment for, value of food at university
*** TODO what are the biggest expenditures in the zero-vat set? good to check those vat rates.
*** is it half of households or half of individuals who have no income?
** add features
*** household VAT rates by income decile
*** ? include people/spending (already drawn)
*** make x-ticks more readable on some figures (e.g. fig 7, people/income)
*** TODO every spendinng graph, draw for people even with zero income
*** TODO CDF / spending: draw that for every income decile
*** if we had VAT as a function of estrato, then we could
**** apply those rates to income data from a survey with more incomme data
